language: c

os:
  - linux
  - osx

compiler:
  - gcc
  - clang

sudo: true

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] ; then
                     sudo updatedb ; else sudo /usr/libexec/locate.updatedb ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] ; then
        locate libc.so libm.so libpthread.so libgomp.so libomp.so libiomp5.so ;
            else locate libc.dylib libm.dylib libpthread.dylib libgomp.dylib
                                                libiomp5.dylib libomp.dylib ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]] ; then brew install libomp ; fi
  #- if [[ "$TRAVIS_OS_NAME" == "osx" ]] ; then brew upgrade cmake ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]] ;
                                     then sudo /usr/libexec/locate.updatedb ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]] ; then
                locate libc.dylib libm.dylib libpthread.dylib libgomp.dylib
                                                libiomp5.dylib libomp.dylib ; fi


sudo: false

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] ; then
                                              lsb_release -a ; else sw_vers ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] ; then lscpu ; else sysctl hw ; fi
  - if [[ "$TRAVIS_COMPILER" == "gcc" ]] ; then
                                       gcc --version ; else clang --version ; fi
  - git --version
  - make --version
  - cmake --version
  - cd ..
  - git clone https://github.com/ISCDtoolbox/Commons.git
  - cd Commons
  - git branch test_future_update
  - git checkout test_future_update
  - git pull origin test_future_update
  - mkdir build
  - cd build
  - cmake ..
  - head CMakeFiles/Commons.dir/flags.make
  - head CMakeFiles/Commons.dir/link.txt
  - make
  - make install
  - cd ../../Mshdist
  - mkdir build
  - cd build
  - cmake ..
  - head CMakeFiles/Mshdistance.dir/flags.make
  - head CMakeFiles/Mshdistance.dir/link.txt
  - head CMakeFiles/mshdist.dir/flags.make
  - head CMakeFiles/mshdist.dir/link.txt
  - make
  - make install
  - cp ../documentation/Examples/batkeep.sol
                                      ../documentation/Examples/batkeep.save.sol
  - mshdist ../documentation/Examples/batkeep.mesh -ncpu 1
  - rm ../documentation/Examples/batkeep.sol
  - cp ../documentation/Examples/batkeep.save.sol
                                           ../documentation/Examples/batkeep.sol
  - mshdist ../documentation/Examples/batkeep.mesh -ncpu 4
  - rm ../documentation/Examples/batkeep.sol
  - cp ../documentation/Examples/batkeep.save.sol
                                           ../documentation/Examples/batkeep.sol
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                then cd ../../Commons/build ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                             then rm ./* -r ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                     then cmake .. -DOPENMP=1 -DFORCEIOMP=1 ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                then head CMakeFiles/Commons.dir/flags.make ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                  then head CMakeFiles/Commons.dir/link.txt ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                                  then make ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                          then make install ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                then cd ../../Mshdist/build ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                             then rm ./* -r ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                              then cmake .. ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                            then head CMakeFiles/Mshdistance.dir/flags.make ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                              then head CMakeFiles/Mshdistance.dir/link.txt ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                then head CMakeFiles/mshdist.dir/flags.make ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                  then head CMakeFiles/mshdist.dir/link.txt ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                                  then make ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                                                          then make install ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                then mshdist ../documentation/Examples/batkeep.mesh -ncpu 1 ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                              then rm ../documentation/Examples/batkeep.sol ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                         then cp ../documentation/Examples/batkeep.save.sol
                                      ../documentation/Examples/batkeep.sol ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                then mshdist ../documentation/Examples/batkeep.mesh -ncpu 4 ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                              then rm ../documentation/Examples/batkeep.sol ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$TRAVIS_COMPILER" == "clang" ]] ;
                         then cp ../documentation/Examples/batkeep.save.sol
                                      ../documentation/Examples/batkeep.sol ; fi
  - cd ../../Commons/build
  - rm ./* -r
  - cmake .. -DOPENMP=1
  - head CMakeFiles/Commons.dir/flags.make
  - head CMakeFiles/Commons.dir/link.txt
  - make
  - make install
  - cd ../../Mshdist/build
  - rm ./* -r
  - cmake ..
  - head CMakeFiles/Mshdistance.dir/flags.make
  - head CMakeFiles/Mshdistance.dir/link.txt
  - head CMakeFiles/mshdist.dir/flags.make
  - head CMakeFiles/mshdist.dir/link.txt
  - make
  - make install
  - mshdist ../documentation/Examples/batkeep.mesh -ncpu 1
  - rm ../documentation/Examples/batkeep.sol
  - cp ../documentation/Examples/batkeep.save.sol
                                           ../documentation/Examples/batkeep.sol
  - mshdist ../documentation/Examples/batkeep.mesh -ncpu 4
  - rm ../documentation/Examples/batkeep.sol
  - cp ../documentation/Examples/batkeep.save.sol
                                           ../documentation/Examples/batkeep.sol

notifications:
  email: false

